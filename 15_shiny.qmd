# Shiny: Aplicaciones Web Interactivas

Este cap칤tulo ense침a a crear dashboards interactivos con Shiny, el equivalente de Streamlit en R.

::: {.callout-note}
## Comparaci칩n con Python
| Python | R |
|--------|---|
| Streamlit | Shiny |
| Dash | Shiny |
| Panel | Shiny |
:::

***

## 1. Estructura de una App Shiny

Una aplicaci칩n Shiny tiene dos componentes:

1. **UI (User Interface)**: Define qu칠 ve el usuario
2. **Server**: Define la l칩gica y c치lculos

### Ejemplo 1.1: App m칤nima

```r
library(shiny)

ui <- fluidPage(
  titlePanel("Mi Primera App"),
  
  sidebarLayout(
    sidebarPanel(
      sliderInput("distancia", "Distancia m치xima:", 
                  min = 5, max = 35, value = 20)
    ),
    
    mainPanel(
      plotOutput("shotmap")
    )
  )
)

server <- function(input, output) {
  output$shotmap <- renderPlot({
    # C칩digo que usa input$distancia
    ggplot(...) + ...
  })
}

shinyApp(ui = ui, server = server)
```

---

***

## 2. Inputs: Controles de Usuario

### Tipos comunes de inputs

| Input | Funci칩n | Uso |
|-------|---------|-----|
| Slider | `sliderInput()` | Valores num칠ricos |
| Selector | `selectInput()` | Opciones predefinidas |
| Checkbox | `checkboxInput()` | S칤/No |
| Texto | `textInput()` | Texto libre |
| Fecha | `dateInput()` | Selecci칩n de fecha |

### Ejemplo 2.1: M칰ltiples inputs

```r
sidebarPanel(
  selectInput("jugador", "Selecciona Jugador:",
              choices = c("Garc칤a", "L칩pez", "Mart칤nez")),
  
  sliderInput("minutos", "Rango de minutos:",
              min = 0, max = 90, value = c(0, 90)),
  
  checkboxInput("mostrar_xg", "Mostrar xG", value = TRUE)
)
```

---

***

## 3. Outputs: Lo que Muestra la App

### Tipos de outputs

| Output | UI Function | Server Function |
|--------|-------------|-----------------|
| Gr치fico | `plotOutput()` | `renderPlot()` |
| Tabla | `tableOutput()` | `renderTable()` |
| Tabla interactiva | `dataTableOutput()` | `renderDataTable()` |
| Texto | `textOutput()` | `renderText()` |
| UI din치mico | `uiOutput()` | `renderUI()` |

---

***

## 4. Ejemplo Completo: Dashboard de Tiros

```r
library(shiny)
library(tidyverse)

# Datos
tiros <- tibble(
  Jugador = sample(c("Garc칤a", "L칩pez", "Mart칤nez"), 50, replace = TRUE),
  X = runif(50, 70, 100),
  Y = runif(50, 20, 80),
  xG = runif(50, 0.02, 0.5),
  Minuto = sample(1:90, 50),
  Gol = sample(c("S칤", "No"), 50, replace = TRUE, prob = c(0.2, 0.8))
)

# UI
ui <- fluidPage(
  titlePanel("Dashboard de Tiros"),
  
  sidebarLayout(
    sidebarPanel(
      selectInput("jugador", "Jugador:",
                  choices = c("Todos", unique(tiros$Jugador))),
      sliderInput("minutos", "Rango de minutos:",
                  min = 0, max = 90, value = c(0, 90)),
      checkboxInput("solo_goles", "Solo goles", value = FALSE)
    ),
    
    mainPanel(
      plotOutput("shotmap"),
      hr(),
      h4("Estad칤sticas"),
      tableOutput("stats")
    )
  )
)

# Server
server <- function(input, output) {
  
  # Datos filtrados (reactivo)
  datos_filtrados <- reactive({
    df <- tiros %>%
      filter(Minuto >= input$minutos[1], Minuto <= input$minutos[2])
    
    if (input$jugador != "Todos") {
      df <- df %>% filter(Jugador == input$jugador)
    }
    
    if (input$solo_goles) {
      df <- df %>% filter(Gol == "S칤")
    }
    
    df
  })
  
  # Shotmap
  output$shotmap <- renderPlot({
    ggplot(datos_filtrados(), aes(x = X, y = Y, size = xG, color = Gol)) +
      geom_point(alpha = 0.7) +
      scale_color_manual(values = c("S칤" = "red", "No" = "gray")) +
      coord_fixed(ratio = 1, xlim = c(60, 105), ylim = c(0, 100)) +
      labs(title = paste("Tiros:", nrow(datos_filtrados()))) +
      theme_minimal()
  })
  
  # Estad칤sticas
  output$stats <- renderTable({
    datos_filtrados() %>%
      summarise(
        Tiros = n(),
        Goles = sum(Gol == "S칤"),
        xG_total = round(sum(xG), 2),
        Conversion = paste0(round(mean(Gol == "S칤") * 100, 1), "%")
      )
  })
}

# Ejecutar app
shinyApp(ui = ui, server = server)
```

---

***

## 5. Despliegue

### Opciones para publicar tu app:

1. **shinyapps.io**: Gratis hasta 5 apps, f치cil de usar
2. **Shiny Server**: Self-hosted, requiere servidor
3. **Posit Connect**: Soluci칩n enterprise

### Publicar en shinyapps.io

```r
library(rsconnect)

# Configurar cuenta (solo una vez)
rsconnect::setAccountInfo(name='tu_usuario',
                          token='tu_token',
                          secret='tu_secret')

# Publicar
rsconnect::deployApp()
```

---

***

## 游끥 Mini-Proyecto: Dise침a tu App

### Ejercicio: Esquema de Dashboard GPS

Dise침a (en pseudoc칩digo) un dashboard que permita:
1. Seleccionar un jugador
2. Ver su carga semanal en un gr치fico de l칤neas
3. Comparar con el promedio del equipo
4. Mostrar alertas si supera umbrales

```r
# Escribe tu pseudoc칩digo aqu칤:
# ui <- fluidPage(...)
# server <- function(input, output) { ... }
```

::: {.callout-tip collapse="true"}
## Ver soluci칩n
```r
ui <- fluidPage(
  titlePanel("Dashboard de Carga GPS"),
  
  sidebarLayout(
    sidebarPanel(
      selectInput("jugador", "Jugador:", choices = jugadores),
      sliderInput("semanas", "Semanas a mostrar:", min = 1, max = 12, value = 6),
      numericInput("umbral", "Umbral de alerta (km):", value = 50)
    ),
    
    mainPanel(
      plotOutput("grafico_carga"),
      h4("Alertas"),
      uiOutput("alertas")
    )
  )
)

server <- function(input, output) {
  datos <- reactive({
    gps %>%
      filter(Jugador == input$jugador) %>%
      tail(input$semanas)
  })
  
  output$grafico_carga <- renderPlot({
    ggplot(datos(), aes(x = Semana, y = Distancia_km)) +
      geom_line() +
      geom_hline(yintercept = input$umbral, color = "red", linetype = "dashed")
  })
  
  output$alertas <- renderUI({
    sobrecarga <- datos() %>% filter(Distancia_km > input$umbral)
    if (nrow(sobrecarga) > 0) {
      tags$div(class = "alert alert-danger",
               paste("춰Alerta! Semanas con sobrecarga:", nrow(sobrecarga)))
    }
  })
}
```
:::

---

## Resumen

| Concepto | Streamlit (Python) | Shiny (R) |
|----------|---------------------|-----------|
| Input slider | `st.slider()` | `sliderInput()` |
| Input select | `st.selectbox()` | `selectInput()` |
| Gr치fico | `st.pyplot()` | `plotOutput()` + `renderPlot()` |
| Tabla | `st.dataframe()` | `tableOutput()` + `renderTable()` |
| Estado | Autom치tico | `reactive()` |
